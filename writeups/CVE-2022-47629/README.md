# Testing Environment

The Dockerfile here was used to spin up a container to build and test exploits against the library. It can be built by running:

```bash
docker build -t research-libksba-debug .
```

Then started by running:

```bash
docker run -v `pwd`:/home/pwner/pwn -ti research-libksba-debug
```

This will mount the working directory on the container. To test out the exploits, just compile and run them: 

```bash
gcc -g -o exploit2 ./exploit2.c -lksba
```

- `exploit1.c` works against libksba 1.6.1, this is the original bug (CVE-2022-3515)
- `exploit2.c` works against libksba 1.6.1 and 1.6.2, this is the variant bug (CVE-2022-47629)
- `dirmngr-noaslr-shell.crl` works against libksba 1.6.1 and 1.6.2, this is the variant bug that can be used directly against `dirmngr`:
  ```bash
  dirmngr --load-crl dirmngr-noaslr-shell.crl
  ```
  If stack canaries are enabled when compiling libksba, or if testing on a system with ASLR on, or a different system altogether, this will just cause a crash.

The target version can be changed in the Dockerfile.

For the exploits to work properly, ASLR must be disabled (on the host system). To disable ASLR, run:

```bash
echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
```

And to re-enable it after, run:

```bash
echo 2 | sudo tee /proc/sys/kernel/randomize_va_space
```

GDB with gef is installed to make it nicer to debug.
